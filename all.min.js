const six_api="livejs-api.hexschool.io",api_pach="kurokawa",list=document.querySelector(".productWrap"),selectPr=document.querySelector(".productSelect"),cartList=document.querySelector(".js-rederprlist"),deleteBtn=document.querySelector(".discardAllBtn"),total=document.querySelector(".total"),sendBtn=document.querySelector(".orderInfo-btn"),form=document.querySelector(".orderInfo-form");let data=[],cartary=[];function init(){getPrList(),getcartPr()}function getPrList(){axios.get(`https://${six_api}/api/livejs/v1/customer/kurokawa/products`).then((function(t){data=t.data.products,rederPr(data)}))}function combHTMLstr(t){return` <li class="productCard">\n<h4 class="productType">新品</h4>\n<img src="${t.images}" alt="${t.title}">\n<a href="javascript:;" class="js-addcart" id="addCardBtn" data-cartId="${t.id}">加入購物車</a>\n<h3>${t.title}</h3>\n<del class="originPrice">NT$${t.origin_price}</del>\n<p class="nowPrice">NT$${t.price}</p>\n</li>`}function rederPr(){let t="";data.forEach(((e,a)=>{t+=combHTMLstr(e)})),list.innerHTML=t}function getcartPr(){axios.get(`https://${six_api}/api/livejs/v1/customer/kurokawa/carts`).then((function(t){cartary=t.data.carts,rederCartPr()}))}function rederCartPr(){let t="",e=0;cartary.forEach(((a,r)=>{t+=`  \n<tr>\n    <td width="40%">\n        <div class="cardItem-title">\n            <img src="${a.product.images}" alt="">\n            <p>${a.product.title}</p>\n        </div>\n    </td>\n    <td width="15%">NT$${a.product.price}</td>\n    <td width="20%">\n    <p class="cartAmount">數量: \n    <a href="#"><span class="material-icons cartAmount-icon" data-num="${a.quantity-1}" data-id="${a.id}">remove</span></a>\n    <span>${a.quantity}</span>\n    <a href="#"><span class="material-icons cartAmount-icon" data-num="${a.quantity+1}" data-id="${a.id}">add</span></a>\n  </p>\n    </td>\n    <td width="15%">NT$${a.product.price*a.quantity}</td>\n    <td class="discardBtn" width="15%">\n        <a href="javascript:;" class="material-icons" data-theId="${a.id}" title="刪除${a.product.title}" data-name="${a.product.title}"> \n            clear\n        </a>\n    </td>\n   \n</tr>\n`,e+=a.product.price*a.quantity})),cartList.innerHTML=t,document.querySelectorAll(".cartAmount-icon").forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault(),editCartNum(t.target.dataset.num,t.target.dataset.id)}))})),total.innerHTML=`NT$${e}`}function editCartNum(t,e){if(t>0){let a=`https://${six_api}/api/livejs/v1/customer/kurokawa/carts`,r={data:{id:e,quantity:parseInt(t)}};axios.patch(a,r).then((function(t){getcartPr()})).catch((function(t){}))}else alert("全部刪除"),deleteCartItem(e)}function deleteCartItem(t){axios.delete(`https://${six_api}/api/livejs/v1/customer/kurokawa/carts/${t}`).then((function(t){getcartPr()}))}function delAllcart(){axios.delete(`https://${six_api}/api/livejs/v1/customer/kurokawa/carts`).then((function(t){Swal.fire({position:"top-center",icon:"success",title:"刪除購物車成功",showConfirmButton:!1}),getcartPr()}))}function addCartPr(t){let e=1;cartary.forEach((function(a){a.product.id===t&&(e=a.quantity+=1)})),axios.post(`https://${six_api}/api/livejs/v1/customer/kurokawa/carts`,{data:{productId:t,quantity:e}}).then((function(t){Swal.fire({position:"top-center",icon:"success",title:"加入購物車成功"}),getcartPr()}))}function sendfrom(){axios.post(`https://${six_api}/api/livejs/v1/customer/kurokawa/orders`).then((function(t){}))}function createOrder(t){let e={data:{user:{name:t.name,tel:t.tel,email:t.Email,address:t.address,payment:t.payment}}};axios.post(`https://${six_api}/api/livejs/v1/customer/kurokawa/orders`,e).then((function(t){Swal.fire({position:"top-center",icon:"success",title:"訂單建立成功!",showConfirmButton:!1}),getcartPr()}))}init(),selectPr.addEventListener("change",(function(t){let e=t.target.value;if("全部"==e)return void rederPr();let a="";data.forEach((t=>{t.category==e&&(a+=combHTMLstr(t)),list.innerHTML=a}))})),cartList.addEventListener("click",(function(t){let e=t.target.getAttribute("data-theId"),a=`刪除「${t.target.getAttribute("data-name")}」成功！`;null!=e&&(Swal.fire({position:"top-center",icon:"success",title:a,showConfirmButton:!1}),deleteCartItem(e))})),deleteBtn.addEventListener("click",(function(t){delAllcart()})),list.addEventListener("click",(function(t){if("js-addcart"!==t.target.getAttribute("class"))return;addCartPr(t.target.getAttribute("data-cartid"))})),sendBtn.addEventListener("click",(function(t){if(t.preventDefault(),"NT$0"==total.textContent)return void alert("尚未選擇產品！");let e=document.querySelector("#customerName").value,a=document.querySelector("#customerPhone").value,r=document.querySelector("#customerEmail").value,n=document.querySelector("#customerAddress").value,i=document.querySelector("#tradeWay").value;""!=e&&""!=a&&""!=r&&""!=n?(createOrder({name:e,tel:a,Email:r,address:n,payment:i}),form.reset()):Swal.fire({position:"top-center",icon:"warning",title:"有欄位資料未填寫！",showConfirmButton:!1})}));