const api_pach="kurokawa",list=document.querySelector(".productWrap"),selectPr=document.querySelector(".productSelect"),cartList=document.querySelector(".js-rederprlist"),deleteBtn=document.querySelector(".discardAllBtn"),total=document.querySelector(".total"),sendBtn=document.querySelector(".orderInfo-btn"),form=document.querySelector(".orderInfo-form");let data=[],cartary=[];function init(){getPrList(),getcartPr()}function getPrList(){axios.get("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/products").then((function(t){data=t.data.products,rederPr(data)}))}function combHTMLstr(t){return` <li class="productCard">\n<h4 class="productType">新品</h4>\n<img src="${t.images}" alt="${t.title}">\n<a href="javascript:;" class="js-addcart" id="addCardBtn" data-cartId="${t.id}">加入購物車</a>\n<h3>${t.title}</h3>\n<del class="originPrice">NT$${t.origin_price}</del>\n<p class="nowPrice">NT$${t.price}</p>\n</li>`}function rederPr(){let t="";data.forEach(((e,r)=>{t+=combHTMLstr(e)})),list.innerHTML=t}function getcartPr(){axios.get("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/carts").then((function(t){cartary=t.data.carts,rederCartPr()}))}function rederCartPr(){let t="",e=0;cartary.forEach(((r,a)=>{t+=`  \n<tr>\n    <td width="40%">\n        <div class="cardItem-title">\n            <img src="${r.product.images}" alt="">\n            <p>${r.product.title}</p>\n        </div>\n    </td>\n    <td width="15%">NT$${r.product.price}</td>\n    <td width="20%">\n    <p class="cartAmount">數量: \n    <a href="#"><span class="material-icons cartAmount-icon" data-num="${r.quantity-1}" data-id="${r.id}">remove</span></a>\n    <span>${r.quantity}</span>\n    <a href="#"><span class="material-icons cartAmount-icon" data-num="${r.quantity+1}" data-id="${r.id}">add</span></a>\n  </p>\n    </td>\n    <td width="15%">NT$${r.product.price*r.quantity}</td>\n    <td class="discardBtn" width="15%">\n        <a href="javascript:;" class="material-icons" data-theId="${r.id}" title="刪除${r.product.title}" data-name="${r.product.title}"> \n            clear\n        </a>\n    </td>\n   \n</tr>\n`,e+=r.product.price*r.quantity})),cartList.innerHTML=t,document.querySelectorAll(".cartAmount-icon").forEach((function(t){t.addEventListener("click",(function(t){t.preventDefault(),editCartNum(t.target.dataset.num,t.target.dataset.id)}))})),total.innerHTML=`NT$${e}`}function editCartNum(t,e){if(t>0){let r="https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/carts",a={data:{id:e,quantity:parseInt(t)}};axios.patch(r,a).then((function(t){getcartPr()})).catch((function(t){}))}else alert("全部刪除"),deleteCartItem(e)}function deleteCartItem(t){axios.delete(`https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/carts/${t}`).then((function(t){getcartPr()}))}function delAllcart(){axios.delete("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/carts").then((function(t){Swal.fire({position:"top-center",icon:"success",title:"刪除購物車成功",showConfirmButton:!1}),getcartPr()}))}function addCartPr(t){let e=1;cartary.forEach((function(r){r.product.id===t&&(e=r.quantity+=1)})),axios.post("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/carts",{data:{productId:t,quantity:e}}).then((function(t){Swal.fire({position:"top-center",icon:"success",title:"加入購物車成功"}),getcartPr()}))}function sendfrom(){axios.post("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/orders").then((function(t){}))}function createOrder(t){let e={data:{user:{name:t.name,tel:t.tel,email:t.Email,address:t.address,payment:t.payment}}};axios.post("https://hexschoollivejs.herokuapp.com/api/livejs/v1/customer/kurokawa/orders",e).then((function(t){Swal.fire({position:"top-center",icon:"success",title:"訂單建立成功!",showConfirmButton:!1}),getcartPr()}))}init(),selectPr.addEventListener("change",(function(t){let e=t.target.value;if("全部"==e)return void rederPr();let r="";data.forEach((t=>{t.category==e&&(r+=combHTMLstr(t)),list.innerHTML=r}))})),cartList.addEventListener("click",(function(t){let e=t.target.getAttribute("data-theId"),r=`刪除「${t.target.getAttribute("data-name")}」成功！`;null!=e&&(Swal.fire({position:"top-center",icon:"success",title:r,showConfirmButton:!1}),deleteCartItem(e))})),deleteBtn.addEventListener("click",(function(t){delAllcart()})),list.addEventListener("click",(function(t){if("js-addcart"!==t.target.getAttribute("class"))return;addCartPr(t.target.getAttribute("data-cartid"))})),sendBtn.addEventListener("click",(function(t){if(t.preventDefault(),"NT$0"==total.textContent)return void alert("尚未選擇產品！");let e=document.querySelector("#customerName").value,r=document.querySelector("#customerPhone").value,a=document.querySelector("#customerEmail").value,n=document.querySelector("#customerAddress").value,c=document.querySelector("#tradeWay").value;""!=e&&""!=r&&""!=a&&""!=n?(createOrder({name:e,tel:r,Email:a,address:n,payment:c}),form.reset()):Swal.fire({position:"top-center",icon:"warning",title:"有欄位資料未填寫！",showConfirmButton:!1})}));