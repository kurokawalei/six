const api_pach="kurokawa",six_pach="livejs-api.hexschool.io",config={headers:{Authorization:"sNSFHkuxupYBy2nL1EZHexiDb652"}};let orderAry=[];const list=document.querySelector(".renderlist"),delAllBtn=document.querySelector(".discardAllBtn"),loading=document.querySelector(".center");function getOrderList(){axios.get(`https://${six_pach}/api/livejs/v1/admin/kurokawa/orders`,config).then((function(t){orderAry=t.data.orders,renOrdList(),loadC3(),loading.innerHTML=""})).catch((function(t){}))}function renOrdList(){let t="";orderAry.forEach(((e,r)=>{const a=new Date(1e3*e.createdAt),n=`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()}`;let i="";e.products.forEach(((t,e)=>{i+=`<div>${t.title} x ${t.quantity}</div>`}));let d="";d=1==e.paid?"已處理":"未處理",t+=`<tr>\n       <td>${e.id}</td>\n       <td>\n         <p>${e.user.name}</p>\n         <p>${e.user.tel}</p>\n       </td>\n       <td>${e.user.address}</td>\n       <td>${e.user.email}</td>\n       <td>\n         ${i}\n       </td>\n       <td>${n}</td>\n       <td >\n         <a href="javascript:;" data-id="${e.id}" data-states="${e.paid}" class="orderStatus">${d}</a>\n       </td>\n       <td>\n         <input type="button" class="delSingleOrder-Btn" value="刪除" data-id="${e.id}">\n       </td>\n   </tr>`})),list.innerHTML=t}function orderStates(t,e){let r;r="true"!=e;let a={data:{id:t,paid:r}};axios.put(`https://${six_pach}/api/livejs/v1/admin/kurokawa/orders`,a,config).then((function(t){alert("訂單狀態已更新！"),getOrderList()}))}function delOrderList(t){axios.delete(`https://${six_pach}/api/livejs/v1/admin/kurokawa/orders/${t}`,config).then((function(t){alert("刪除單筆成功"),getOrderList()}))}function delAll(t){t.preventDefault(),axios.delete(`https://${six_pach}/api/livejs/v1/admin/kurokawa/orders`,config).then((function(t){alert("已全部刪除"),getOrderList()}))}function loadC3(){let t={},e={},r=["#ff9800","#db880e","#f8ac3c"];orderAry.forEach((function(e){e.products.forEach((function(e){null==t[e.category]?t[e.category]=e.price*e.quantity:t[e.category]+=e.price*e.quantity}))}));let a=Object.keys(t);a.forEach(((t,a)=>{e[t]=r[a]}));let n=[];a.forEach(((e,r)=>{let a=[];a.push(e),a.push(t[e]),n.push(a)}));c3.generate({bindto:"#chart",data:{type:"pie",columns:n,colors:e}})}getOrderList(),list.addEventListener("click",(function(t){let e=t.target.getAttribute("class"),r=t.target.getAttribute("data-id");if("delSingleOrder-Btn"!=e)if("orderStatus"!=e);else{orderStates(r,t.target.getAttribute("data-states"))}else delOrderList(r)})),delAllBtn.addEventListener("click",delAll);